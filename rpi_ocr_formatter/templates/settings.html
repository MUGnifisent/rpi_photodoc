{% extends "base.html" %}
{% block title %}Settings{% endblock %}

{% block head %}
<style>
    .settings-container {
        max-width: 800px;
        margin: 3rem auto;
    }
    .prompt-textarea {
        min-height: 150px;
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        font-size: 0.9em;
        white-space: pre-wrap; /* Ensure whitespace is respected */
    }
    .field label.label {
        font-weight: bold;
        color: #e0e0e0; /* Ensure labels are visible */
    }
</style>
{% endblock %}

{% block content %}
<!-- The main navbar is inherited from base.html. No need to repeat it here. -->
<!-- We just need to ensure the active state is correctly handled in base.html for this page -->

<section class="section">
    <div class="container settings-container">
        <div class="box">
            <h1 class="title is-3 has-text-centered">Application Settings</h1>
            <p class="subtitle is-6 has-text-centered has-text-grey-light mb-5">Configure LLM connection and default AI prompts.</p>

            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="notification is-{{ 'success' if category == 'success' else 'danger' }} is-light is-small mb-4">
                            <button class="delete is-small"></button>
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <form method="POST" action="{{ url_for('settings.manage_settings') }}">
                <h2 class="title is-5">LLM Configuration</h2>
                <div class="field">
                    <label class="label" for="llm_server_url">LLM Server URL</label>
                    <div class="control has-icons-left">
                        <input class="input" type="url" id="llm_server_url" name="llm_server_url" value="{{ settings.llm_server_url }}" placeholder="e.g. http://localhost:11434/api/generate" required>
                        <span class="icon is-small is-left"><i class="fas fa-server"></i></span>
                    </div>
                </div>

                <div class="field">
                    <label class="label" for="llm_model_name">LLM Model Name</label>
                    <div class="control has-icons-left">
                        <input class="input" type="text" id="llm_model_name" name="llm_model_name" value="{{ settings.llm_model_name }}" placeholder="e.g. llama3.1:8b" required>
                         <span class="icon is-small is-left"><i class="fas fa-brain"></i></span>
                    </div>
                </div>
                
                <hr>
                <h2 class="title is-5 mt-5">Default Prompt Templates</h2>
                <p class="is-size-7 has-text-grey-light mb-4">Edit the default prompts used for various AI actions. The AI will append the relevant text to these templates.</p>

                {% for key in default_prompt_keys %}
                <div class="field mb-5">
                    <label class="label" for="prompt_{{key}}">{{ key.replace('_', ' ') | title }}</label>
                    <div class="control">
                        <textarea id="prompt_{{key}}" name="prompt_{{key}}" class="textarea prompt-textarea" rows="6">{{ settings.prompts.get(key, '') }}</textarea>
                    </div>
                </div>
                {% endfor %}

                <div class="field mt-6">
                    <div class="control">
                        <button type="submit" class="button is-primary is-fullwidth is-medium">
                            <span class="icon"><i class="fas fa-save"></i></span>
                            <span>Save All Settings</span>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    // Navbar burger and notification dismissal are handled in base.html
    // No page-specific JS needed here for now beyond what base.html provides.
});
</script>
{% endblock %} 