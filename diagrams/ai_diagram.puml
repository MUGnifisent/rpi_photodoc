@startuml
!theme plain

start

:Вхідне зображення;

:Попередня обробка зображення;
note right
  Адаптивне підвищення контрасту (CLAHE)
  Білатеральне фільтрування шумів
  Корекція геометричних спотворень
end note

:Ініціалізація системи штучного інтелекту;

partition "Оптичне розпізнавання символів (EasyOCR)" {
  :Завантаження нейронної мережі CRNN;
  note left
    Convolutional Recurrent Neural Network
    Згорткові шари для витягування ознак
    Рекурентні шари для послідовного аналізу
  end note
  
  :Сегментація тексту на зображенні;
  
  :Розпізнавання символів через нейронну мережу;
  
  :Формування послідовностей символів;
  
  :Застосування мовної моделі для корекції;
  
  :Генерація сирого тексту OCR;
}

if (Потрібна додаткова обробка через LLM?) then (так)
  
  partition "Обробка через велику мовну модель" {
    :Підключення до локального LLM-сервера;
    note right
      Модель: LLaMA 3 (8B параметрів)
      Квантизована для оптимізації
      Локальне розгортання
    end note
    
    :Вибір типу обробки;
    
    if (Очищення OCR) then 
      :Застосування промпту для виправлення помилок розпізнавання;
    elseif (Резюмування) then
      :Застосування промпту для стиснення тексту;
    elseif (Переклад) then
      :Застосування промпту для перекладу тексту;
    elseif (Виділення даних) then
      :Застосування промпту для екстракції інформації;
    else
      :Застосування користувацького запиту;
      note right
        Користувацький промпт, визначений вручну
      end note
    endif
    
    :Передача тексту та промпту до LLM;
    
    :Обробка через нейронну мережу трансформер;
    note left
      Архітектура трансформер
      Механізм уваги (attention)
      Багатошарова обробка
    end note
    
    :Генерація обробленого тексту;
  }
  
  :Оброблений текст через ШІ;
  
else (ні)
  :Сирий текст OCR;
endif

:Постобробка результату;
note right
  Форматування
  Валідація
  Структурування
end note

:Збереження результатів у базі даних;

if (Додати до документу?) then (так)
  :Інтеграція з існуючими документами;
else (ні)
  :Збереження як окрема фотографія;
endif

:Відображення результату користувачеві;

stop

@enduml